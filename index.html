<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Malix</title>
        <style>
body {
    font-family: Monserrat, sans-serif;
    margin: 40px auto;
    max-width: 1250px;
    color: #363636;
    background-color: #f7f7f7;
    padding: 0 10px
}
        container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .country {
            stroke: #aaaaaa;
            fill: rgba(0, 0, 0, 0);
            filter: drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1));
        }
        .clickable {
            cursor: pointer;
        }
        .collected {
            fill: #a7c9a8;
            stroke: #aaaaaa;
            transition: 0.2s ease-in-out;
        }
        .highlighted {
            fill: #5a915c;
            stroke: #5a915c;
            filter: drop-shadow(0px 10px 10px rgba(0, 0, 0, 0.4));
            transition: 0.2s ease-in-out;
            z-index: 1000;
        }
        #table{
            border-collapse: collapse;
            width: 80%;
            border-radius: 5px;
        }
        td, th {
            padding: 8px;
        }
        tr:nth-child(even){
            background-color: #ebebeb;
        }
        .trHighlight {
            background-color: #a7c9a8;
        }
        tr:hover {background-color: #a7c9a8;}
        th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #5a915c;
            color: white;
        }
        .tableColorContainer {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .tableColorDiv {
            width: 40px;
            height: 15px;
            border-radius: 5px;
        }
        #picture-zoom {
            position: fixed;
            top: 40px;
            right: 40px;
            justify-content: center;
            align-items: center;
        }
        .fade {
            width: 300px;
            height: 300px;
            cursor: zoom-out;
            border-radius: 15%; 
            filter: drop-shadow(0px 13px 13px rgba(0, 0, 0, 0.2));
        }
        </style>
    </head>
    <body>
        <h1>Les sables de Malix</h1>
        <div class="container" id="map-container">
            <div width="960" height="500" id="map"></div>
        </div>

        <div class="container" id="table-container">
            <table id="table">
                <thead>
                    <tr>
                        <th>Couleur</th>
                        <th>Pays</th>
                        <th>Lieu</th>
                        <th>Donn√© par</th>
                        <th>Photo</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div id="picture-zoom"></div>
        <!-- Load d3.js -->
        <script src="https://d3js.org/d3.v5.min.js"></script>

        <script type="text/javascript" src='static/map.js'></script>
        <script>
            document.getElementById("picture-zoom").addEventListener("click", () => {
                document.getElementById("picture-zoom").innerHTML = "";
            });

            const table = document.getElementById("table");

            const delay = ms => new Promise(res => setTimeout(res, ms));
            const loadSands = async () => {
                await delay(300);
                console.log("Waited 1s");
            };
            loadSands().then(() => {
             fetch("static/sand.json")
                .then(response => response.json())
                .then(json => {
                    let sands = json.data;
                    sands = sands.sort((a, b) => {
                        return a.place.countryFR.localeCompare(b.place.countryFR);
                    });


                    table.tBodies[0].innerHTML = sands.map(sand => {
                        let sandPath = document.getElementById(sand.place.country);
                        if (sandPath) {
                            sandPath.classList.add("collected");
                        } 

                        return `
                            <tr class="${sand.place.country}">
                            <td class="tableColorContainer"><div class="tableColorDiv" style="background-image: url('https:\/\/sand-collection.s3.eu-central-1.amazonaws.com\/zoom\/${sand.picture}');"></div></td>
                            <td>${sand.place.countryFR}</td>
                            <td>${sand.place.name}</td>
                            <td>${sand.giftedBy}</td>
                            <td><a href="https://sand-collection.s3.eu-central-1.amazonaws.com/${sand.picture}">photo</a></td>
                            </tr>
                            `;
                    }).join("");
                
            });
               
                    

                const pictureZoom = document.getElementById("picture-zoom");
                [].slice.call(document.querySelectorAll("#table tr"), 1).forEach(tr => {
                    const country = tr.classList.value;
                    tr.addEventListener("mouseover", () => {
                        if (country){
                            document.getElementById(country).classList.add("highlighted");
                        }
                        pictureZoom.innerHTML = `<img class="fade" src="${tr.querySelector("a").href}" width="400" height="400">`;
                        console.log(tr.querySelector("a").href);
                    });
                    tr.addEventListener("mouseout", () => {
                        if (country){
                            document.getElementById(country).classList.remove("highlighted");
                        }
                    });
                });
            });

        </script>
    </body>
</html>
